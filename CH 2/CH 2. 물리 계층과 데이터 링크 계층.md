# CH 2. 물리 계층과 데이터 링크 계층

## 2-1 이더넷

**물리 계층**과 **데이터 링크 계층**은 이더넷이라는 공통된 기술이 사용된다. **이더넷**은 현대 LAN, 특히 유선 LAN 환경에서 가장 대중적으로 사용되는 기술로 다양한 통신 매체의 규격들과 송수신되는 프레임의 형태, 프레임을 주고받는 방법 등이 정의된 네트워크 기술이다.

### 이더넷 표준

오늘날의 유선 LAN 환경은 대부분 이더넷을 기반으로 구성된다. 현재 이더넷은 국제적으로 표준화가 이루어졌다. 전기전자공학자협회라는 국제 조직은 이더넷 관련 기술을 **IEEE 802.3**이라는 이름으로 표준화했다. 이더넷 표준에 따라 지원되는 네트워크 장비, 통신 매체의 종류와 전송 속도 등이 달라질 수 있다.

### 통신 매체 표기 형태

#### 1. 전송 속도

숫자만 표기되어 있으면 Mbps 속도, 숫자 뒤에 G가 붙어 있는 경우 Gbps 속도를 의미한다. 예를 들어 100Base-T 케이블은 100Mbps 속도를 지원하는 케이블, 10GBASE-T는 10Gbps 속도를 지원하는 케이블이다.

#### 2. BASE

BASE는 **베이스밴드**의 약자로, **변조 타입**을 의미한다. 변조 타입이란 비트 신호로 변환된 데이터를 통신 매체로 전송하는 방법을 의미한다. 일반적인 LAN 환경에서는 대부분 디지털 신호를 송수신하는 베이스밴드 방식을 사용한다.

#### 3. 추가 특성

**추가 특성**에는 통신 매체의 특성을 명시한다. 이곳에 명시할 수 있는 특성의 종류는 다양하다. 10BASE-2, 10BASE-5와 같이 **전송 가능한 최대 거리**가 명시되기도 하고, 데이터가 비트 신호로 변환되는 방식을 의미하는 **물리 계층 인코딩** 방식이 명시되기도 하며, 비트 신호를 옮길 수 있는 전송로 수를 의미하는 **레인 수**가 명시되기도 한다.

### 통신 매체 종류

추가 특성에 C, T, S, L이라는 글자가 있다면 이는 각각 동축 케이블(C), 트위스티드 페어 케이블(T), 단파장 빛을 활용하는 광섬유 케이블(S), 장파장 빛을 활용하는 광섬유 케이블(L)을 의미한다.

### 이더넷 프레임

현대 유선 LAN 환경은 대부분 이더넷을 기반으로 구성되므로 호스트가 데이터 링크 계층에서 주고받는 프레임 형식도 정해져 있다. 즉, 이더넷 네트워크에서 주고받는 프레임인 **이더넷 프레임** 형식은 정해져 있다.

이더넷 프레임은 상위 계층으로부터 받아들인 정보에 헤더와 트레일러를 추가하는 **캡슐화** 과정을 통해 만들어진다. 수신지 입장에서는 프레임의 헤더와 트레일러를 제거한 뒤 상위 계층으로 올려보내는 **역캡슐화** 과정을 거친다.

이더넷 프레임 헤더는 기본적으로 프리앰블, 수신지 MAC 주소, 송신지 MAC 주소, 타입/길이로 구성되고, 페이로드는 데이터, 트레일러는 FCS로 구성된다.

#### 프리앰블

**프리앰블**은 이더넷 프레임의 시작을 알리는 8바이트(64비트) 크기의 정보이다. 프리앰블의 첫 7바이트는 10101010 값을 가지고, 마지막 바이트는 101010**11** 값을 가진다. 수신지는 이 프리앰블을 통해 이더넷 프레임이 오고 있음을 알아차린다. 즉, 프리앰블은 송수신지 간의 동기화를 위해 사용되는 정보이다.

#### 수신지 MAC 주소와 송신지 MAC 주소

'물리적 주소'라고도 불리는 **MAC 주소**는 데이터 링크 계층의 핵심이다. MAC 주소는 네트워크 인터페이스마다 부여되는 6바이트 길이의 주소로, LAN 내의 수신지와 송신지를 특정할 수 있다.

MAC 주소는 일반적으로 고유하고, 변경되지 않는 주소로써 네트워크 인터페이스마다 부여된다. 보통 NIC(Network Interface Controller)라는 장치가 네트워크 인터페이스 역할을 담당한다. 즉, 한 컴퓨터에 NIC가 여러 개 있다면 MAC 주소도 여러 개 있을 수 있다.

#### 타입/길이

타입/길이 필드에는 **타입** 혹은 **길이**가 올 수 있다. 필드에 명시된 크기가 1500(16진수 05DC) 이하일 경우 이 필드는 프레임의 크기(길이)를 나타내는 데 사용되고, 1536(16진수 0600) 이상일 경우에는 타입을 나타내는 데 사용된다.

타입이란 이더넷 프레임이 '어떤 정보를 캡슐화했는지'를 나타내는 정보이다. **이더타입**이라고도 부른다. 대표적으로 상위 계층에서 사용된 프로토콜의 이름이 명시된다.

#### 데이터

데이터는 상위 계층에서 전달받거나 상위 계층으로 전달해야 할 내용이다. 네트워크 계층의 데이터와 헤더를 합친 PDU가 이곳에 포함된다. 최대 크기는 1500바이트로, 유의할 점은 반드시 46바이트 이상이여야 한다는 점이다. 그 이하의 데이터라면 크기를 맞추기 위해 **패딩**이라는 정보가 내부에 채워진다. 보통 46바이트 이상이 될 때까지 0으로 채워진다.

#### FCS

**FCS(Frame Check Sequence)**는 수신한 이더넷 프레임에 오류가 있는지 확인하기 위한 필드이다. 이 필드에는 **CRC(Cyclic Redundancy Check)**, 즉 순환 중복 검사라고 불리는 오류 검출용 값이 들어간다.

송신지는 프리앰블을 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 후, 이 값을 FCS 필드에 명시한다. 그리고 수신지는 수신한 프레임에서 프리앰블과 FCS 필드를 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 뒤, 이 값을 FCS 필드 값과 비교한다. 이때 비교 값이 일치하지 않으면 프레임에 오류가 있다고 판단하여 해당 프레임을 폐기한다.

## 2-2 NIC와 케이블

**NIC**는 호스트와 통신매체를 연결하고, MAC 주소가 부여되는 네트워크 장비이다. **케이블**은 NIC에 연결되는 물리 계층의 유선 통신 매체이다.

### NIC(Network Interface Controller)

NIC는 호스트가 신호를 이해할 수 있도록 통신 매체를 통해 전달되는 신호와 컴퓨터가 이해할 수 있는 정보 간에 변환을 담당한다.

#### NIC의 역할

NIC는 통신 매체에 흐르는 신호를 호스트가 이해하는 프레임으로 변환하거나 반대로 호스트가 이해하는 프레임을 통신 매체에 흐르는 신호로 변환한다. 따라서 호스트가 네트워크를 통해 송수신하는 정보는 NIC를 거치게 된다. 이처럼 NIC는 네트워크와의 연결점을 담당한다는 점에서 **네트워크 인터페이스** 역할을 수행한다고도 한다.

MAC 주소는 네트워크 인터페이스마다 할당되고, NIC는 네트워크 인터페이스 역할을 수행한다. NIC는 MAC 주소를 통해 자기 주소는 물론, 수신되는 프레임의 수신지 주소를 인식한다. 그래서 어떤 프레임이 자신에게 도달했을 때 자신과는 관련 없는 수신지 MAC 주소가 명시된 프레임이라면 폐기할 수 있고, FCS 필드를 토대로 오류를 검출해 잘못된 프레임을 페기할 수도 있다.

### 트위스티드 페어 케이블

**트위스티드 페어 케이블**은 구리 선으로 전기 신호를 주고받는 통신 매체이다.

#### 트위스티드 페어 케이블의 생김새

트위스티드 페어 케이블은 **케이블 본체**와 케이블의 연결부인 **커넥터**로 이루어져 있다. 본체 내부는 구리 선이 두 가닥씩 꼬아져 있다. 그런데 본체가 구리 선으로 이루어진 상태에서 전기 신호를 주고받다 보면 구리 선에 전자적 간섭이 생길 수 있다. 이렇게 전기 신호를 왜곡시킬 수 있는 간섭을 **노이즈**라고 부른다.

트위스티드 페어 케이블은 구리 선으로 이루어졌기에 노이즈에 민감하다. 구리 선 주변을 감싸 노이즈를 감소시키는 방식을 **차폐**라고 하고, 차폐에 사용된 그물 모양의 철사와 포일을 각각 **브레이브 실드** 혹은 **포일 실드**라고 한다.

#### 실드에 따른 트위스티드 페어 케이블의 분류

브레이브 실드로 감싼 케이블은 **STP**(Shielded Twisted Pair) 케이블, 포일 실드로 감싼 케이블은 **FTP**(Foil Twisted Pair) 케이블이라고 한다. 아무것도 감싸지 않은 케이블은 **UTP**(Unshielded Twisted Pair) 케이블이라고 부른다.

다음은 케이블 명칭 표기 예시이다. X와 Y에는 U, S, F를 명시할 수 있다.

## XX/YTP

- U: 실드 없음
- S: 브레이브 실드
- F: 포일 실드

XX에는 케이블 외부를 감싸는 실드의 종류가 명시된다. 하나 혹은 두 개일 수도 있다. 그리고 Y에는 꼬인 구리 선 쌍을 감싸는 실드의 종류가 명시된다.

#### 카테고리에 따른 트위스티드 페어 케이블의 분류

트위스티드 페어 케이블은 **카테고리**에 따라서도 분류할 수 있다. 카테고리는 트위스티드 페어 케이블 성능의 등급을 구분하는 역할을 한다. 높은 카테고리에 속한 케이블일수록 높은 성능을 보인다.

카테고리는 영문 표기 Category에서 앞의 세 글자를 딴 **Cat**이라는 표기로 줄여서 표현하는 경우가 많다.

카테고리에 따라 지원 대역폭, 주요 대응 규격, 전송 속도와 같은 케이블의 성능이 각각 다르다. 카테고리가 높을수록 지원 가능한 대역폭이 높아지는데, 이는 카테고리가 높은 트위스티드 케이블은 송수신 할 수 있는 데이터의 양이 더 많고, 더 빠른 전송이 가능함을 시사한다.

### 광섬유 케이블

**광섬유 케이블**은 빛을 이용해 정보를 주고받는 케이블이다. 빛을 이용하여 전송하기에 전기 신호를 이용하는 케이블에 비해 속도도 빠르고, 먼 거리까지 전송이 가능하다. 노이즈로부터 간섭받는 영향도 적다.

#### 광섬유 케이블의 생김새

광섬유도 케이블도 케이블 본체와 커넥터로 이루어져 있다. 다만 커넥터의 종류가 좀 더 다양하다. 대표적으로는 LC 커넥터, SC 커넥터, FC 커넥터, ST 커넥터가 있다.

광섬유 케이블 본체 내부는 머리카락과 같은 형태의 광섬유로 구성되어 있다. 광섬유는 빛을 운반하는 매체이다. 광섬유 중심에는 **코어**가 있다. 코어는 광섬유에서 실질적으로 빛이 흐르는 부분이다. 그리고 코어를 둘러싸는 **클래딩**이 있다. 클래딩은 빛이 코어 안에서만 흐르도록 빛을 가두는 역할을 한다.

광섬유 케이블은 코어의 지름에 따라 **싱글 모드 광섬유 케이블**과 **멀티 모드 광섬유 케이블**로 나뉜다. 여기서 싱글 모드와 멀티 모드는 광섬유 케이블의 종류를 구분하는 가장 기본적인 기준이다.

#### 싱글 모드 광섬유 케이블

싱글 모드와 멀티 모드 케이블의 주된 차이점은 코어의 지름이다. 싱글 모드는 코어의 지름이 8~10μm 정도로, 멀티 모드 케이블에 비해 작다.

코어의 지름이 작다면 빛의 이동 경로가 하나 이상을 갖기 어렵고, 이를 두고 싱글 모드라고 표현한다.

싱글 모드 케이블은 신호 손실이 적기에 장거리 전송에 적합하다. 반면 멀티 모드에 비해 일반적으로 비용이 높다는 단점이 있다.

싱글 모드 케이블은 파장이 긴 장파장의 빛을 사용한다.

#### 멀티 모드 광섬유 케이블

멀티 모드는 코어의 지름이 50~62.5μm 정도로 싱글 모드보다 크다. 그러므로 빛이 여러 경로로 이동할 수 있다.

멀티 모드는 싱글 모드보다 전송 시 신호 손실이 클 수 있기에 장거리 전송에는 부적합하다. 실제로 싱글 모드 케이블은 수십 킬로미터까지 전송이 가능한 데 비해, 멀티 모드 케이블은 일반적으로 수백 미터, 길어야 수 킬로미터 정도만 전송이 가능하다. 그래서 멀티 모드 케이블은 비교적 근거리를 연결하는 데 주로 사용된다.

또한 멀티 모드 케이블은 싱글 모드에 비해 단파장의 빛을 사용한다.

## 2-3 허브

### 주소 개념이 없는 물리 계층

물리 계층에는 주소 개념이 없다. 송수신지를 특정할 수 있는 주소는 데이터 링크 계층부터 존재하는 개념이다. 물리 계층에서는 단지 호스트와 통신 매체 간의 연결과 통신 매체상의 송수신이 이루어진다. 그렇기에 물리 계층의 네트워크 장비는 송수신되는 정보에 대한 어떠한 조작이나 판단을 하지 않는다.

반면 데이터 링크 계층에는 주소 개념이 있다. MAC 주소가 여기에 속한다. 따라서 데이터 링크 계층의 장비나 그 이상 계층의 장비들은 송수신지를 특정할 수 있고, 주소를 바탕으로 송수신되는 정보에 대한 조작과 판단을 할 수 있다.

### 허브

물리 계층의 **허브**는 여러 대의 호스트를 연결하는 장치이다. **리피터 허브**라 부르기도 하고, 이더넷 네트워크의 허브는 **이더넷 허브**라고도 부른다.

허브에는 호스트와 연결된 통신 매체를 연결할 수 있는 **포트**가 있다.

#### 허브의 특징

**첫째, 전달받은 신호를 다른 모든 포트로 그대로 다시 내보낸다.**

허브는 물리 계층에 속한 장비이므로 신호를 전달받으면 어떠한 조작이나 판단을 하지 않고 송신지를 제외한 모든 포트에 그저 내보내기만 한다. 허브를 통해 이 신호를 전달받은 모든 호스트는 데이터 링크 계층에서 패킷의 MAC 주소를 확인하고 자신과 관련 없는 주소는 폐기한다.

**둘때, 반이중 모드로 통신한다.**

**반이중** 모드는 마치 1차선 도로처럼 송수신을 번갈아 가면서 하는 통신 방식이다. 즉, 동시에 송수신이 불가능하다. 반대로 **전이중** 모드는 송수신을 동시에 양방향으로 할 수 있는 통신 방식이다.

#### 콜리전 도메인

만일 호스트가 동시에 허브에 신호를 송신하면 **충돌(콜리전)**이 발생한다. 허브에 호스트가 많이 연결되어 있을수록 충돌 발생 가능성이 높다. 이렇게 충돌이 발생할 수 있는 영역을 **콜리전 도메인**이라고 한다. 허브에 연결된 모든 호스트는 같은 콜리전 도메인에 속한다.

허브의 넓은 콜리전 도메인으로 인한 충돌 문제를 해결하려면 **CSMA/CD** 프로토콜 사용하거나 스위치 장비를 사용해야 한다.

### CSMA/CD

CSMA/CD는 반이중 이더넷 네트워크에서 충돌을 방지하는 대표적인 프로토콜이다. 이더넷을 대표하는 송수신 방법이라 볼 수 있다.

**CSMA/CD**는 Carrier Sense Multiple Access with Collision Detection의 약자이다.

**첫째, CS는 Carrier Sense, 캐리어 감지를 의미한다.**

메시지를 보내기 전에 현재 네트워크상에서 전송 중인 것이 있는지를 먼저 확읺다. 이를 **캐리어 감지**라고 한다.

**둘째, MA는 Multiple Access, 다중 접근을 의미한다.**

때로는 캐리어 감지를 하는 데도 두 개 이상의 호스트가 부득이하게 동시에 네트워크르 사용하려 할 때가 있다. 복수의 호스트가 네트워크에 접근하려는 상황을 **다중 접근**이라고 한다. 이때 충돌이 발생한다.

**셋째, CD는 Collision Detection, 충돌 검출을 의미한다.**

충돌이 발생하면 이를 검출하는데, 이를 **충돌 검출**이라고 한다. 충돌을 감지하면 전송이 중단되고, 충돌을 검출한 호스트는 다른 이들에게 충돌이 발생했음을 알리고자 잼 신호라는 특별한 신호를 보낸다. 그리고 임의의 시간 동안 기다린 뒤에 다시 전송한다.

## 2-4 스위치

### 스위치

**스위치**는 데이터 링크 계층의 네트워크 장비이다. 2계층에서 사용한다 하여 **L2 스위치**라고도 부른다. 스위치는 허브와는 달리 MAC 주소를 학습해 특정 MAC 주소를 가진 호스트에만 프레임을 전달할 수 있고, 전이중 모드의 통신을 지원한다. 그렇기에 스위치를 이용하면 포트별로 콜리전 도메인이 나뉘고, 전이중 모드로 통신하므로 CSMA/CD 프로토콜이 필요하지 않다.

#### 스위치의 특징

스위치의 가장 중요한 특징은 특정 포트와 해당 포트에 연결된 호스트의 MAC 주소와의 관계를 기억한다는 점이다. 이를 통해 원하는 호스트에만 프레임을 전달할 수 있다. 스위치의 이러한 기능을 **MAC 주소 학습**이라고 부른다.

스위치는 MAC 주소 학습을 위해 포트와 연결된 호스트의 MAC 주소 간의 연관 관계를 메모리에 표 형태로 기억한다. 스위치의 포트와 연결된 호스트의 MAC 주소 연관 관계를 나타내는 정보를 **MAC 주소 테이블**이라고 부른다.

### MAC 주소 학습

스위치가 처음 특정 호스트에서 프레임을 수신하면, 프레임 내 '송신지 MAC 주소'를 바탕으로 호스트의 MAC 주소와 연결된 포트를 MAC 주소 테이블에 저장한다. 이 상황에서 스위치는 마치 허브처럼 송신지 포트를 제외한 모든 포트로 프레임을 전송한다. 이러한 스위치의 동작을 **플러딩**이라고 한다. 수신 호스트는 스위치로 응답 프레임을 전송하고 나머지 호스트는 프레임을 폐기한다. 이를 통해 스위치는 수신 호스트의 MAC 주소와 연결된 호스트를 알아내어 이 정보를 MAC 주소 테이블에 기록한다.

전달받은 프레임을 어디로 내보내고 어디로 내보내지 않을지 결정하는 스위치의 기능을 **필터링**이라고 한다. 그리고 프레임이 전송될 포트에 실제로 프레임을 내보내는 것을 **포워딩**이라고 한다.

만약 MAC 주소 테이블에 등록된 특정 포트에서 일정 시간 동안 프레임을 전송받지 못했다면 해당 항목은 삭제된다. 이를 **에이징**이라고 한다.

### VLAN

스위치의 또 다른 중요한 기능으로 **VLAN**이 있다. **VLAN**은 Virtual LAN의 줄임말로, 이름 그대로 한 대의 스위치로 가상의 LAN을 만드는 방법이다.

스위치에 연결된 호스트 중에서도 서로 메시지를 주고받을 일이 적거나 브로드캐스트 메시지를 받을 필요가 없어서 굳이 같은 네트워크(LAN)에 속할 필요가 없는 호스트가 있을 수도 있다. 이때 구성하는 것이 VLAN이다.

VLAN을 구성하면 한 대의 물리적 스위치라 해도 여러 대의 스위치가 있는 것처럼 논리적인 단위로 LAN을 구획할 수 있다.

#### 포트 기반 VLAN

**포트 기반 VLAN**은 한 마디로 '스위치의 포트가 VLAN을 결정하는 방식'이다. 사전에 특정 포트에 VLAN을 할당하고, 해당 포트에 호스트를 연결함으로써 VLAN에 포함시킬 수 있다.

**VLAN 트렁킹**은 두 대 이상의 VLAN 스위치를 효율적으로 연결하여 확장하는 방법이다. 스위치 간의 통신을 위한 특별한 포트인 **트렁크 포트**에 VLAN 스위치를 서로 연결하는 방식이다.

#### MAC 기반 VLAN

**MAC 기반 VLAN**은 포트가 VLAN을 결정하는 것이 아니라 송수신하는 프레임 속 MAC 주소가 호스트가 속할 VLAN을 결정하는 방식이다.
